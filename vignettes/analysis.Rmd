---
title: "Analysis Vignette"
author: "Vignette Author"
date: "`r Sys.Date()`"
vignette: >
  %\VignetteIndexEntry{Analysis Vignette}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
output: 
  html_document: 
    fig_caption: yes
    number_sections: yes
    toc: yes
---


```{r setup, echo = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  cache = FALSE
)
```

# Preamble

For interactive / manual vignette building, setting caching instead to TRUE 
in the above code chunk can dramatically speed up the builds, by caching the results of each chunk. Note that the above chunk is not shown in the built version of the vignette because of the `echo=FALSE` option.

First load the analysis library:
```{r}
library(ProjectAsPackage)
```

# R Markdown

This vignette is
written in [Rmarkdown](http://rmarkdown.rstudio.com). You can find [details
about markdown here](http://rmarkdown.rstudio.com/authoring_basics.html) and
[details about code chunks
here](http://rmarkdown.rstudio.com/authoring_rcodechunks.html).

# Data

Note that there are several ways to include data in your package, documented at 
http://r-pkgs.had.co.nz/data.html. 
**ProjectAsPackage** demonstrates two ways:

1. as a prepared R object (in this case `data.frame`) prepared and stored as `data/gardasil.rda`in the package's directory and documented in the file `R/gardasil.R`.
2. as a *.csv* file `inst/extdata/gardasil.csv`

## Option 1 - data cleaning done prior to saving an R object in package directory `data/gardasil.rda`:

```{r datagardasil}
data(gardasil)
class(gardasil)
summary(gardasil)
```

The data-cleaning script used to create the `data/gardasil.rda` file is traditionally provided in the `data-raw/` Note that there is a help file for this dataset as well, serving as a codebook. This was generated by the file `R/gardasil.R` using *roxygen* markup, then using *roxygen2* to automatically create the documentation file `man/gardasil.Rd`:

```{r}
?gardasil
```

## Option 2 - a function to load and clean the raw data

See the function `R/read_gardasil.R`, with automatically-generated help page `man/read_gardasil.Rd`.

```{r}
?read_gardasil
```

```{r read_gardasil}
gardasil2 <- read_gardasil()
class(gardasil2)
summary(gardasil2)
```

You may wish to provide arguments to this function, e.g.:
```{r}
summary(gardasil2$RaceSummary)
gardasil3 <- read_gardasil(other.as.NA = TRUE)
summary(gardasil3$RaceSummary)
```

# Analysis

## Regression analysis

Univariate regressions like the following reproduce Table 2 of Chou *et al.* Relative to public insurance, holders of private, hospital-based, and military insurance are more likely to complete the vaccine series.

```{r}
fitins <- glm(Completed ~ InsuranceType,
           data=gardasil,
           family=binomial(link='logit'))
summary(fitins)
round(exp(coef(fitins)), 2)
```


## An example figure

```{r, fig.cap="Mosaic plot of number of shots completed against type of insurance"}
mosaicplot(InsuranceType ~ Shots, data=gardasil)
```


# Session Information

This shows which packages and versions were used for the analysis. Note that under
RStudio "Tools - Project Options" you can select "Packrat" to create a project-specific
library to ensure other analysts will run the exact same version of all packages.

```{r, sessioninfo}
options(width = 100)
sessionInfo()
```

Note, if you have devtools installed you might use `devtools::session_info()` to provide a more detailed and structured session info.

